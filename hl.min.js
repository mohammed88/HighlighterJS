var k={a:"=",ALPHA:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b:function(){try{return new DOMException}catch(a){var b=Error("DOM Exception 5");b.code=b.h=5;b.name=b.description="INVALID_CHARACTER_ERR";b.toString=function(){return"Error: "+b.name+": "+b.message};return b}},f:function(a,b){var c=k.ALPHA.indexOf(a.charAt(b));if(-1===c)throw k.b();return c},decode:function(a){a=""+a;var b=k.f,c,d,e,f=a.length;if(0===f)return a;if(0!==f%4)throw k.b();c=0;a.charAt(f-1)===k.a&&(c=
1,a.charAt(f-2)===k.a&&(c=2),f-=4);var h=[];for(d=0;d<f;d+=4)e=b(a,d)<<18|b(a,d+1)<<12|b(a,d+2)<<6|b(a,d+3),h.push(String.fromCharCode(e>>16,e>>8&255,e&255));switch(c){case 1:e=b(a,d)<<18|b(a,d+1)<<12|b(a,d+2)<<6;h.push(String.fromCharCode(e>>16,e>>8&255));break;case 2:e=b(a,d)<<18|b(a,d+1)<<12,h.push(String.fromCharCode(e>>16))}return h.join("")},c:function(a,b){var c=a.charCodeAt(b);if(255<c)throw k.b();return c},encode:function(a){if(1!==arguments.length)throw new SyntaxError("Not enough arguments");
var b=k.a,c=k.ALPHA,d=k.c,e,f,h=[];a=""+a;var l=a.length-a.length%3;if(0===a.length)return a;for(e=0;e<l;e+=3)f=d(a,e)<<16|d(a,e+1)<<8|d(a,e+2),h.push(c.charAt(f>>18)),h.push(c.charAt(f>>12&63)),h.push(c.charAt(f>>6&63)),h.push(c.charAt(f&63));switch(a.length-l){case 1:f=d(a,e)<<16;h.push(c.charAt(f>>18)+c.charAt(f>>12&63)+b+b);break;case 2:f=d(a,e)<<16|d(a,e+1)<<8,h.push(c.charAt(f>>18)+c.charAt(f>>12&63)+c.charAt(f>>6&63)+b)}return h.join("")}};window.base64=k;(function(y){function n(){}function z(a,c){var b=eval("("+base64.decode(a)+")");b.start.reference=r(b.start.reference,c);b.end.reference=r(b.end.reference,c);return new p(b.start,b.end)}function l(a,c,b,d){if("h-l"===a.parentNode.nodeName.toLowerCase())a.parentNode.setAttribute("ref",d);else{var e=a.parentNode,f=document.createElement("h-l"),h=a.nodeValue,k=h.substr(0,c);c=h.substr(c,b-c);b=h.substr(b);f.setAttribute("ref",d);f.appendChild(document.createTextNode(c));e.insertBefore(f,a);e.removeChild(a);
0<k.length&&e.insertBefore(document.createTextNode(k),f);0<b.length&&(f.nextSibling?e.insertBefore(document.createTextNode(b),f.nextSibling):e.appendChild(document.createTextNode(b)))}}function A(a){if(a.firstChild)return a.firstChild;for(;a;){if(a.nextSibling)return a.nextSibling;a=a.parentNode}}function t(a){for(var c="",b,d;a&&1==a.nodeType;a=a.parentNode){b=a.previousSibling;for(d=1;null!=b;)1===b.nodeType&&b.tagName.toLowerCase()===a.tagName.toLowerCase()&&d++,b=b.previousSibling;1<d?d="["+d+
"]":d="";c="/"+a.tagName.toLowerCase()+d+c}return c}function r(a,c){var b,d=c.body.childNodes,e=a.split("/").splice(3);Array.prototype.slice.call(d).unshift(c.body);for(var f=0,h=0,k,g;f<e.length&&2>h;){-1!==e[f].indexOf("[")?(g=e[f].split("["),k=g[0],g=g[1].split("]"),g=parseInt(g[0])):(k=e[f],g=1);for(var m=0,l=d.length;m<l;m++)if(d[m].nodeName.toUpperCase()===k.toUpperCase()&&(--g,0===g)){b=d[m];d=b.childNodes;f++;break}if(m===l)if("tr"===k.toLowerCase())for(k=0,g=d.length;k<g;k++){if("tbody"===
d[k].nodeName.toLowerCase()){b=d[k];d=b.childNodes;break}}else"tbody"===k.toLowerCase()?f++:h++}return b}function u(a,c){var b,d,e;1===a.nodeType?"h-l"===a.nodeName.toLowerCase()?(e=q(a,"none",c),b=e.reference,d=e.relation,c=e.offset):(b=a,d="none"):a.previousSibling&&1===a.previousSibling.nodeType?"h-l"===a.previousSibling.nodeName.toLowerCase()?(e=q(a.previousSibling,"prev-sib",c),b=e.reference,d=e.relation,c=e.offset):(b=a.previousSibling,d="prev-sib"):"h-l"===a.parentNode.nodeName.toLowerCase()?
(e=q(a.parentNode,"parent",c),b=e.reference,d=e.relation,c=e.offset):(b=a.parentNode,d="parent");return new v(b,d,c)}function q(a,c,b){var d=!1,e;if("prev-sib"===c)b+=a.innerHTML.length;else if("parent"===c||"none"===c)c="prev-sib";for(e=a.previousSibling;e;){if(1===e.nodeType)if("h-l"!==e.nodeName.toLowerCase()){a=e;d=!0;break}else b+=e.innerHTML.length;else b+=e.nodeValue.length;e=e.previousSibling}d||(a=a.parentNode,c="parent");return new v(a,c,b)}function w(a){var c;c=a.reference;var b=a.relation;
a=a.offset;"none"!==b&&("prev-sib"===b?3===c.nextSibling.nodeType&&c.nextSibling.nodeValue.length>a?c=c.nextSibling:(b=x(c,b,a),c=b.node,a=b.offset):3===c.nextSibling.nodeType&&c.nextSibling.nodeValue.length>a?c=c.firstChild:(b=x(c,b,a),c=b.node,a=b.offset));return{node:c,offset:a}}function x(a,c,b){var d;"prev-sib"===c?d=a.nextSibling:"parent"===c&&(d=a.firstChild);for(;;){3===d.nodeType?a=d.nodeValue.length:("h-l"!==d.nodeName.toLowerCase()&&console.log("Check line 367!!"),a=d.innerHTML.length);
b-=a;if(0>b)break;d=d.nextSibling}return{node:d,offset:b+a}}function v(a,c,b){this.reference=a;this.relation=c;this.offset=b}function p(a,c){this.start=a;this.end=c}n.prototype.init=function(a,c,b){var d=[];if("string"===typeof a)a=z(a,c);else{var e=a;console.log(e);a=e.startContainer;d=e.endContainer;c=e.startOffset;e=e.endOffset;1===a.parentNode.nodeType&&"h-l"===a.parentNode.nodeName.toLowerCase()&&(a=document.querySelector("[ref='"+a.parentNode.getAttribute("ref")+"']"),c=0);1===d.parentNode.nodeType&&
"h-l"===d.parentNode.nodeName.toLowerCase()&&(d=document.querySelector("[ref='"+d.parentNode.getAttribute("ref")+"']:last-child"),e=d.innerHTML.length);e={startContainer:a,endContainer:d,startOffset:c,endOffset:e};a=new p(u(e.startContainer,e.startOffset),u(e.endContainer,e.endOffset))}d=w(a.start);c=w(a.end);a:{for(var e=c.node,f=[],h=[],k=/[ \t\n\r]/g,g=d.node;g;g=A(g))if(3===g.nodeType&&0<g.nodeValue.replace(k,"").length&&f.push(g),1===g.nodeType&&"h-l"===g.nodeName.toLowerCase()&&h.pushUnique(g.getAttribute("ref")),
g===e){e={nodes:f,merged:h};break a}e=void 0}f=e.nodes;if(1===f.length)l(f[0],d.offset,c.offset,b);else for(h=0,k=f.length;h<k;h++)0===h?l(f[h],d.offset,f[h].nodeValue.length,b):h===k-1?l(f[h],0,c.offset,b):l(f[h],0,f[h].nodeValue.length,b);d=e.merged;a.start.reference=t(a.start.reference);a.end.reference=t(a.end.reference);return{key:base64.encode(a.stringify()),merged:d.length?!0:!1,mergedItems:d}};n.prototype.remove=function(a,c){if(a&&1==a.nodeType){if("h-l"===a.nodeName.toLowerCase()&&-1!==a.getAttribute("ref").indexOf(c)){var b=
a.removeChild(a.firstChild);a.parentNode.insertBefore(b,a);a.parentNode.removeChild(a);return!0}for(var b=!1,d=a.childNodes.length-1;0<=d;d--)this.remove(a.childNodes[d],c)&&(b=!0);b&&(-1===navigator.userAgent.indexOf("rv:11")?a.normalize():b(a))}return!1};Array.prototype.pushUnique=function(a){-1===this.indexOf(a)&&this.push(a)};p.prototype.stringify=function(){function a(a){return'{"reference":"'+a.reference+'","relation":"'+a.relation+'","offset":'+a.offset+"}"}return'{"start":'+a(this.start)+
',"end"  :'+a(this.end)+"}"};y.$h=function(){var a=new n;return{create:function(c,b){console.log("Make");var d=c.getSelection().getRangeAt(0);return a.init(d,c,b)},apply:function(c,b,d){console.log("Apply");return a.init(c,b,d)},remove:function(c,b){console.log("Remove");return a.remove(c.body,b)}}}()})("undefined"!==typeof window?window:this);